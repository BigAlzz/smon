{% extends 'base.html' %}
{% load static %}

{% block title %}Progress Update Success{% endblock %}

{% block content %}
<div class="container">
  <!-- Success Header -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Main Success Card -->
      <div class="card border-success shadow-lg">
        <div class="card-header bg-success text-white text-center py-4">
          <div class="mb-3">
            <i class="bi bi-check-circle-fill display-1"></i>
          </div>
          <h2 class="mb-0">
            {% if success_data.action == 'submitted' %}
              🎉 Progress Update Submitted Successfully!
            {% else %}
              💾 Progress Update Saved as Draft!
            {% endif %}
          </h2>
          <p class="mb-0 lead">
            {% if success_data.action == 'submitted' %}
              Your progress has been submitted for approval
            {% else %}
              Your progress has been saved and can be submitted later
            {% endif %}
          </p>
        </div>
        
        <div class="card-body p-4">
          <!-- Progress Summary -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h5 class="text-success mb-3">
                <i class="bi bi-clipboard-data me-2"></i>Progress Summary
              </h5>
              <dl class="row">
                <dt class="col-sm-5">Target:</dt>
                <dd class="col-sm-7">{{ success_data.target_name }}</dd>
                
                <dt class="col-sm-5">KPA:</dt>
                <dd class="col-sm-7">{{ success_data.kpa_name }}</dd>
                
                <dt class="col-sm-5">Period:</dt>
                <dd class="col-sm-7">{{ success_data.period_name }}</dd>
                
                <dt class="col-sm-5">Actual Value:</dt>
                <dd class="col-sm-7">
                  <strong>{{ success_data.actual_value }} {{ success_data.unit }}</strong>
                </dd>
                
                <dt class="col-sm-5">Completion:</dt>
                <dd class="col-sm-7">
                  <div class="d-flex align-items-center">
                    <div class="progress flex-grow-1 me-2" style="height: 20px;">
                      <div class="progress-bar bg-{% if success_data.rag_status == 'GREEN' %}success{% elif success_data.rag_status == 'AMBER' %}warning{% else %}danger{% endif %}" 
                           style="width: {{ success_data.percentage }}%">
                        {{ success_data.percentage }}%
                      </div>
                    </div>
                    <span class="badge bg-{% if success_data.rag_status == 'GREEN' %}success{% elif success_data.rag_status == 'AMBER' %}warning{% else %}danger{% endif %}">
                      {{ success_data.rag_status }}
                    </span>
                  </div>
                </dd>
              </dl>
            </div>
            
            <div class="col-md-6">
              <h5 class="text-success mb-3">
                <i class="bi bi-clock-history me-2"></i>Submission Details
              </h5>
              <dl class="row">
                <dt class="col-sm-4">Status:</dt>
                <dd class="col-sm-8">
                  {% if success_data.action == 'submitted' %}
                    <span class="badge bg-primary">
                      <i class="bi bi-check-circle me-1"></i>Submitted for Approval
                    </span>
                  {% else %}
                    <span class="badge bg-secondary">
                      <i class="bi bi-save me-1"></i>Saved as Draft
                    </span>
                  {% endif %}
                </dd>
                
                <dt class="col-sm-4">
                  {% if success_data.action == 'submitted' %}Submitted:{% else %}Saved:{% endif %}
                </dt>
                <dd class="col-sm-8">
                  {% if success_data.action == 'submitted' %}
                    {{ success_data.submitted_at }}
                  {% else %}
                    {{ success_data.saved_at }}
                  {% endif %}
                </dd>
                
                <dt class="col-sm-4">By:</dt>
                <dd class="col-sm-8">{{ user.get_full_name|default:user.username }}</dd>
              </dl>
            </div>
          </div>

          <!-- Next Steps -->
          <div class="alert alert-{% if success_data.action == 'submitted' %}info{% else %}warning{% endif %} mb-4">
            <h6 class="alert-heading">
              <i class="bi bi-info-circle me-2"></i>What Happens Next?
            </h6>
            {% if success_data.action == 'submitted' %}
              <ul class="mb-0">
                <li>📧 <strong>Approvers have been notified</strong> and will review your submission</li>
                <li>⏱️ <strong>Review typically takes 1-3 business days</strong></li>
                <li>🔔 <strong>You'll receive a notification</strong> once the review is complete</li>
                <li>📊 <strong>Your data is now included</strong> in management reports</li>
                <li>🔒 <strong>No further edits</strong> can be made until approval/rejection</li>
              </ul>
            {% else %}
              <ul class="mb-0">
                <li>📝 <strong>Your draft has been saved</strong> and can be edited anytime</li>
                <li>⚠️ <strong>Remember to submit for approval</strong> before the deadline</li>
                <li>📊 <strong>Draft data is not included</strong> in official reports</li>
                <li>✏️ <strong>You can continue editing</strong> and add more evidence if needed</li>
              </ul>
            {% endif %}
          </div>

          <!-- Action Buttons -->
          <div class="row">
            <div class="col-md-6">
              <div class="d-grid gap-2">
                <a href="{% url 'manager_kpa_detail' kpa.id %}" class="btn btn-primary">
                  <i class="bi bi-arrow-left me-2"></i>Back to KPA Dashboard
                </a>
                <a href="{% url 'manager_dashboard' %}" class="btn btn-outline-secondary">
                  <i class="bi bi-house me-2"></i>Manager Dashboard
                </a>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="d-grid gap-2">
                {% if success_data.action == 'saved_draft' %}
                  <a href="{% url 'manager_progress_update' target.id %}" class="btn btn-warning">
                    <i class="bi bi-pencil me-2"></i>Continue Editing
                  </a>
                {% endif %}
                <a href="{% url 'item_detail' target.plan_item.id %}" class="btn btn-outline-info">
                  <i class="bi bi-eye me-2"></i>View Target Details
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Information Cards -->
      <div class="row mt-4">
        {% if success_data.action == 'submitted' %}
          <!-- Approval Process Card -->
          <div class="col-md-6">
            <div class="card border-info">
              <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                  <i class="bi bi-diagram-3 me-2"></i>Approval Process
                </h6>
              </div>
              <div class="card-body">
                <div class="timeline">
                  <div class="timeline-item completed">
                    <i class="bi bi-check-circle-fill text-success"></i>
                    <span>Progress Submitted</span>
                  </div>
                  <div class="timeline-item active">
                    <i class="bi bi-clock text-primary"></i>
                    <span>Under Review</span>
                  </div>
                  <div class="timeline-item">
                    <i class="bi bi-circle text-muted"></i>
                    <span>Approval Decision</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Help & Support Card -->
        <div class="col-md-6">
          <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
              <h6 class="mb-0">
                <i class="bi bi-question-circle me-2"></i>Need Help?
              </h6>
            </div>
            <div class="card-body">
              <p class="small mb-2">If you have questions about your submission:</p>
              <ul class="small mb-0">
                <li>📧 Contact your line manager</li>
                <li>📞 Call the M&E team</li>
                <li>💬 Use the internal help desk</li>
                <li>📖 Check the user manual</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline-item {
  position: relative;
  padding-bottom: 15px;
  display: flex;
  align-items: center;
}

.timeline-item:not(:last-child)::before {
  content: '';
  position: absolute;
  left: -22px;
  top: 20px;
  width: 2px;
  height: 20px;
  background: #dee2e6;
}

.timeline-item.completed::before {
  background: #28a745;
}

.timeline-item.active::before {
  background: #007bff;
}

.timeline-item i {
  position: absolute;
  left: -30px;
  font-size: 16px;
}

.card {
  transition: transform 0.2s ease-in-out;
}

.card:hover {
  transform: translateY(-2px);
}

.progress {
  border-radius: 10px;
}

.badge {
  font-size: 0.8em;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add celebration animation
  const successIcon = document.querySelector('.display-1');
  if (successIcon) {
    successIcon.style.animation = 'bounce 1s ease-in-out';
  }
  
  // Auto-scroll to top
  window.scrollTo(0, 0);
  
  // Add confetti effect for submissions
  {% if success_data.action == 'submitted' %}
    // Simple confetti effect
    setTimeout(() => {
      for (let i = 0; i < 50; i++) {
        createConfetti();
      }
    }, 500);
  {% endif %}
});

function createConfetti() {
  const confetti = document.createElement('div');
  confetti.style.cssText = `
    position: fixed;
    width: 10px;
    height: 10px;
    background: ${['#28a745', '#007bff', '#ffc107', '#dc3545'][Math.floor(Math.random() * 4)]};
    left: ${Math.random() * 100}vw;
    top: -10px;
    z-index: 1000;
    pointer-events: none;
    animation: fall 3s linear forwards;
  `;
  
  document.body.appendChild(confetti);
  
  setTimeout(() => {
    document.body.removeChild(confetti);
  }, 3000);
}

// CSS animation for confetti
const style = document.createElement('style');
style.textContent = `
  @keyframes fall {
    to {
      transform: translateY(100vh) rotate(360deg);
    }
  }
  
  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-30px);
    }
    60% {
      transform: translateY(-15px);
    }
  }
`;
document.head.appendChild(style);
</script>
{% endblock %}
